<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="icon" href="assets/images/myLogo.png">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/style.css">
    <title>Friend Finder | Survey</title>
</head>

<body>
    <div class="container">
        <h3>Survey Questions</h3>
        <hr>
        <p>Note: if a question is unanswered before submitting, the default value will be 3. Please answer all questions for
            the best possible match.</p>
        <h5>About You</h5>
        <form id="survey" role="form">
            <div class="form-group">
                <label for="name">Name (Required)</label>
                <input type="text" class="form-control" id="name" maxlength="50">
            </div>
            <div class="form-group">
                <label for="userPic">Link to Photo Image (Required)</label>
                <input type="text" class="form-control" id="userPic" size="35" maxlength="100" placeholder="e.g. http://www.myImage.com">
            </div>
            <hr>
            <h5>Question 1</h5>
            <div class="form-group">
                <label class="form-check-label mb-2" for="q1">I prefer a quiet evening inside with a good movie versus an outdoor adventure.</label>
                <select class="form-control" id="q1">
                    <option value="" selected disabled>Select an Option</option>
                    <option>1 (Strongly Disagree></option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <h5>Question 2</h5>
            <div class="form-group">
                <label class="form-check-label mb-2" for="q2">I smoke cigarettes.</label>
                <select class="form-control" id="q2">
                    <option value="" selected disabled>Select an Option</option>
                    <option>1 (Strongly Disagree></option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <h5>Question 3</h5>
            <div class="form-group">
                <label class="form-check-label mb-2" for="q3">Religion promotes a healthy society.</label>
                <select class="form-control" id="q3">
                    <option value="" selected disabled>Select an Option</option>
                    <option>1 (Strongly Disagree></option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <h5>Question 4</h5>
            <div class="form-group">
                <label class="form-check-label mb-2" for="q4">I live a healthy lifestyle that includes regular exercise and a healthy diet.</label>
                <select class="form-control" id="q4">
                    <option value="" selected disabled>Select an Option</option>
                    <option>1 (Strongly Disagree></option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <h5>Question 5</h5>
            <div class="form-group">
                <label class="form-check-label mb-2" for="q5">Income inequality is one of the greatest modern challenges.</label>
                <select class="form-control" id="q5">
                    <option value="" selected disabled>Select an Option</option>
                    <option>1 (Strongly Disagree></option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <h5>Question 6</h5>
            <div class="form-group">
                <label class="form-check-label mb-2" for="q6">Pursuing truth and evidence should take precedence over hurting someone's feelings.</label>
                <select class="form-control" id="q6">
                    <option value="" selected disabled>Select an Option</option>
                    <option>1 (Strongly Disagree></option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <h5>Question 7</h5>
            <div class="form-group">
                <label class="form-check-label mb-2" for="q7">I form strong bonds with pets.</label>
                <select class="form-control" id="q7">
                    <option value="" selected disabled>Select an Option</option>
                    <option>1 (Strongly Disagree></option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <h5>Question 8</h5>
            <div class="form-group">
                <label class="form-check-label mb-2" for="q8">I prefer documentaries or news over movies and shows designed to provide fantasy and escape.</label>
                <select class="form-control" id="q8">
                    <option value="" selected disabled>Select an Option</option>
                    <option>1 (Strongly Disagree></option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <h5>Question 9</h5>
            <div class="form-group">
                <label class="form-check-label mb-2" for="q9">It is better to be a good person than to have nice things.</label>
                <select class="form-control" id="q9">
                    <option value="" selected disabled>Select an Option</option>
                    <option>1 (Strongly Disagree></option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <h5>Question 10</h5>
            <div class="form-group">
                <label class="form-check-label mb-2" for="q10">Would you be unfaithful to your spouse if you were angry at him/her and you knew you wouldn't get caught?</label>
                <select class="form-control" id="q10">
                    <option value="" selected disabled>Select an Option</option>
                    <option>1 (Strongly Disagree></option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5 (Strongly Agree)</option>
                </select>
            </div>
            <button id="formSubmit" class="btn btn-primary btn-block" type="submit">Submit</button>
        </form>
        <div class="container mt-3 mb-3">
            <a href="/api/friends">API Friends List</a>
            <span> | </span>
            <a href="https://github.com/chrisjones0517/FriendFinder" target="_blank">GitHub Repo</a>
        </div>
    </div>

    <!-- Modal -->
    <div id="matchDisplay" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Best Match</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Dynamically created elements with match data go here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script type="text/javascript">

        $('#formSubmit').on('click', (e) => {
            e.preventDefault();

            let name = $('#name').val().trim();
            let userPic = $('#userPic').val().trim();

            let pattern = /^(http|https|www)(\.|:)\S*(\.com|\.net|\.org)/;
            let result = pattern.test(userPic);

            if (name === '' || name.indexOf(' ') === -1) {
                alert('Please enter a first and last name!');
            } else if (!result) {
                alert('Please enter a valid image link!');
            } else {

                let score = [];

                for (let i = 1; i < 11; i++) {
                    let answer = $('#q' + i).val();
                    if (answer) {
                        score.push(parseInt(answer.substring(0, 1)));
                    } else {
                        score.push(3);
                    }
                }

                let newUser = {
                    name: $('#name').val().trim(),
                    userPic: $('#userPic').val().trim(),
                    score: score
                };

                let currentURL = window.location.origin;

                $.post(currentURL + '/api/friends', newUser);

                $.ajax({
                    url: currentURL + '/api/friends',
                    method: 'GET'
                }).done((res) => {
                    console.log(res);
                    let tempVal = 41;
                    let bestMatch;
                    res.forEach((item) => {
                        let DBscoreArrStr = item.score;
                        let DBuserTotal = DBscoreArrStr.map(Number).reduce(sum);
                        let currentUserTotal = newUser.score.reduce(sum);
                        let diff = Math.abs(currentUserTotal - DBuserTotal);

                        if (diff < tempVal) {
                            bestMatch = item;
                            tempVal = diff;
                        }
                    });

                    $('.modal-body').empty();
                    $('.modal-body').append(`
                        <h6>${bestMatch.name}</h6>
                        <img src=${bestMatch.userPic} alt="profile image not available" width="250" height="250">
                    `);
                    $('#matchDisplay').modal('show');
                    $('#survey')[0].reset();
                });
            }
            return false;
        });

        function sum(total, num) {
            return total + num;
        }

    </script>
</body>

</html>